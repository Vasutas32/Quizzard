@page "/create-quiz"
@rendermode InteractiveServer
@inject Quizzard.Services.QuizService QuizService
@using Quizzard.Models
@using Microsoft.AspNetCore.Components

<h3>Create a New Quiz</h3>

<!-- Quiz Title Input -->
<input @bind="quizTitle" placeholder="Enter quiz title" />

<!-- Add Question Section -->
<h4>Add Questions</h4>
@foreach (var question in questions)
{
    <div>
        <input @bind="question.Text" placeholder="Question text" />
        <br />

        
        <input value="@question.Options[0]" @oninput="(e) => UpdateOption(question, 0, e.Value?.ToString() ?? string.Empty)" placeholder="Option @(1)" />
        <input value="@question.Options[1]" @oninput="(e) => UpdateOption(question, 1, e.Value?.ToString() ?? string.Empty)" placeholder="Option @(2)" />
        <input value="@question.Options[2]" @oninput="(e) => UpdateOption(question, 2, e.Value?.ToString() ?? string.Empty)" placeholder="Option @(3)" />
        <input value="@question.Options[3]" @oninput="(e) => UpdateOption(question, 3, e.Value?.ToString() ?? string.Empty)" placeholder="Option @(4)" />
        

        <br />
        Correct Answer:
        <select @bind="question.CorrectAnswerIndex">
            @for (int i = 0; i < 4; i++)
            {
                <option value="@i">Option @(i + 1)</option>
            }
        </select>

        <button @onclick="() => RemoveQuestion(question)">Remove</button>
        <hr />
    </div>
}

<button @onclick="AddQuestion">Add Question</button>
<button @onclick="SaveQuiz">Save Quiz</button>
<button @onclick="Cancel">Cancel</button>
<button @onclick="Bello">Do the Bello!</button>

@code {
    private string quizTitle = "";
    private List<Question> questions = new();

    private void Bello()
    {
        Console.WriteLine("I'm doing the bello!!");
    }

    private void AddQuestion()
    {
        questions.Add(new Question { Options = new List<string> { "", "", "", "" } });
        Console.WriteLine("^q^\n");
    }

    private void RemoveQuestion(Question question)
    {
        questions.Remove(question);
    }

    private async Task SaveQuiz()
    {
        if (!string.IsNullOrWhiteSpace(quizTitle) && questions.Count > 0)
        {
            var newQuiz = new Quiz { Title = quizTitle, Questions = questions };
            Console.WriteLine("First question:" + questions[0].Options[0] + "\n");
            await QuizService.AddQuizAsync(newQuiz);
            Navigation.NavigateTo("/quizzes");
        }
    }

    private void Cancel()
    {
        Navigation.NavigateTo("/quizzes");
    }

    void UpdateOption(Question question, int index, string value)
    {
        // Ensure the list has enough elements
        while (question.Options.Count < index)
        {
            question.Options.Add(string.Empty);
        }

        // Now we can safely assign the value
        question.Options[index] = value;
    }



    [Inject] private NavigationManager Navigation { get; set; }
}
